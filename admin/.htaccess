RewriteEngine On
RewriteBase /admin

# Remove trailing slash from /admin/
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} ^(.+)/$
RewriteRule ^ %1 [R=301,L]

# Block direct access to login.php
RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ /admin/login\.php\ HTTP/
RewriteRule ^login\.php$ - [F,L]

# Allow access to login.php through /admin/ while keeping it hidden
RewriteRule ^login$ login.php [L,QSA]

# Redirect from /admin/login.php?pages=login to /admin/login
RewriteCond %{QUERY_STRING} ^pages=login$
RewriteRule ^login\.php$ /admin/login [R=301,L]